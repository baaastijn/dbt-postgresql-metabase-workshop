<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Welcome file</title>
  <link rel="stylesheet" href="style2.css" />
</head>

<body>
  <div><h1 id="dbt--postgresql--metabase-workshop--a-first-analytics-platform">DBT + PostgreSQL + Metabase workshop : a first analytics platform</h1>
<p>Basic workshop to build a first modern analytics platform with DBT, PostgreSQL and Metabase.</p>
<h1 id="hello-what-are-we-going-to-do-tonight-brain">Hello! <em>What are we going to do tonight, Brain?</em></h1>
<h2 id="discovering-awesome-open-source-data-tools">Discovering awesome open source data tools</h2>
<p>Initial goal is to have fun discovering some of most notorious modern data tools, with a typical use-case : analyze your orders and customers.</p>
<p>Over the years, DBT has trusted the charts as the “transformation workflow” tool, same for Metabase as business intelligence tool. They work pretty well together, and are seen in many production architectures.</p>
<p>The last piece of data software that we will discover is PostgreSQL, who will act as a datawarehouse.</p>
<p>While CLickHouse, Google BigQuery or Snowflake might have been excellent choices for a production platform, I selected PostgreSQL because it can be installed locally with zero expenses, and is a perfect fit for our standard needs.</p>
<p>The pipeline that we will create is similar to this schema:</p>
<p><img src="img/dbt-postgresql-metabase.png" alt="first BI platform"></p>
<h2 id="building-your-first-analytics-platform">Building your first analytics platform</h2>
<p>Over this workshop, you will get a first introduction to DBT and Metabase features.</p>
<p>Our use case is quite simple: we are a company, with customers, orders and payments.</p>
<p>We want to build nice visualization dashboards, to monitor closely our activity.</p>
<p>More than dashboards, we want to avoid black magic, avoid technical debt, and for that we will use DBT to introduce best practive for analytics.</p>
<p>What this workshop is not : it’s not an intensive worshop for experts, neither something to follow for best practices (it’s more the opposite since we will skip few phases like Git synchonization, DBT, tests).</p>
<h2 id="time-and-cost">Time and cost</h2>
<p><strong>Expected time for this workshop</strong> : it depends of your skills. If you are new to the cloud, let’s say 4-5 hours.</p>
<p>If your have cloud/tech experience, ±2 hours.</p>
<p><strong>Cost</strong> : <strong>free</strong> if you run everything locally.</p>
<p>In the cloud, more or less 3 euros for 24h in OVHcloud:</p>
<ul>
<li>
<p>AI Notebook (DBT host): 24h x 0,03 € = 0,72€</p>
</li>
<li>
<p>PostgreSQL managed database: 24h x 0,07€ = 1,68€</p>
</li>
<li>
<p>VM instance (metabase host): 24h x 0,0088€ = 0,021€</p>
</li>
</ul>
<p>Ready? See you in few hours!</p>
<h1 id="part-1-setup-your-environment">Part 1: setup your environment</h1>
<h2 id="requirements">Requirements</h2>
<ul>
<li>
<p>A Python &gt;= 3.8 environment with ability to install new packages such as DBT</p>
</li>
<li>
<p>A PostgreSQL client to query a PostgreSQL database (like psql or PgAdmin)</p>
</li>
<li>
<p>Ability to run Docker images (locally or in the cloud) or execute JAR file (for Metabase installation)</p>
</li>
<li>
<p>basic technical skills such as building a SQL query, connect with SSH, …</p>
</li>
</ul>
<h2 id="cloud-or-not-cloud-chose-wisely">Cloud or not cloud? Chose wisely!</h2>
<p>As mentionned in requirements, this workshop will require to install few things such as DBT (Python package), a PostgreSQL client and Metabase (Docker image for the easiest installation way).</p>
<p>You can opt to install everything locally on your computer if you have enough access rights to do it.</p>
<p>You can also prefer to use cloud products such as virtual machines or Python Notebook.</p>
<p>The main advantage for this method is the ability to start with a clean development environment, and be able to delete safely everything at the end. Also, if you don’t have admin on your own computer, it will be easier.</p>
<p>On the dark side, it can be seen as a bit complex if your are new with cloud. So, chose wisely!</p>
<p><strong>For the next step, we will go for cloud products with OVHcloud</strong>, a european cloud provider:</p>
<ul>
<li>
<p>Database: OVHcloud PostgreSQL (AWS doppeldanger : RDS for PostgreSQL)</p>
</li>
<li>
<p>DBT: installed in a OVHcloud Jypter Notebook (AWS : Sagemaker Notebook)</p>
</li>
<li>
<p>Metabase: installed in a OVHcloud virtual Machine (AWS : EC2 VM)</p>
</li>
</ul>
<p>From an architecture perspective, it will look like this in the cloud:</p>
<p><img src="img/infra.workshop.dbt.png" alt="This is an image"></p>
<h2 id="step-1--optional-prepare-a-cloud-python-environment">Step 1 : (optional) prepare a cloud Python environment</h2>
<blockquote>
<p>ℹ️ As explained previously, we will use cloud products in this workshop. It’s optional, <strong>you can skip this step if you prefer to use your own Python environment (your computer for example)</strong>.</p>
</blockquote>
<p>This workshop needs a Python environment, with the ability to browse files easily.</p>
<p>To be more visual and practical, we will opt for a Python notebook code editor. Most used ones in the world are JupyterLab and VSCode. We will create one in the cloud now.</p>
<p>If required, create an OVHcloud free account or log in:</p>
<ol>
<li>
<p>Log in OVHcloud control panel : &lt;https//www.ovhcloud.com&gt;.</p>
</li>
<li>
<p>Go to Public Cloud section in the top menu.</p>
</li>
<li>
<p>Create a new project if required.</p>
</li>
</ol>
<p>Once your project is created, create a new AI Notebook with these parameters:</p>
<ul>
<li>
<p><strong>name</strong>: dbt-notebook</p>
</li>
<li>
<p><strong>code editor</strong>: Jupyter lab</p>
</li>
<li>
<p><strong>Framework</strong>: Miniconda with python &gt;=3.8</p>
</li>
<li>
<p><strong>Privacy</strong>: public access (anyone will have access to it. useful for a workshop, NOT recommended for production or sensitive information)</p>
</li>
<li>
<p><strong>Datacenter</strong>: as you wish</p>
</li>
<li>
<p><strong>Resource</strong>: CPU x1</p>
</li>
<li>
<p><strong>Attach a git repo or data container</strong>: no</p>
</li>
<li>
<p><strong>SSH key</strong>: no</p>
</li>
</ul>
<p>Once your notebook is running (it should take less than 1 minute), you can access it by clicking on <code>JupyterLab</code> button.</p>
<p><img src="img/notebook1.png" alt="AI Notebook - JupyterLab button"></p>
<p>This notebook is a Linux environment running inside a Docker image. It gives you the ability to live code directly in your web browser. You can install additional package swith classic Python commands such as <code>pip install</code>and <code>conda install</code>.</p>
<p>Also, you can share your environment with someone else just by sharing your notebook URL. Very useful during a workshop session when you need some help 😉.</p>
<p>Now, click on the <code>Terminal</code> icon inside this notebook.</p>
<p><img src="img/notebook2.png" alt="AI Notebook - Terminal button"></p>
<h2 id="step-2--check-your-python-environment">Step 2 : check your python environment</h2>
<p>This tutorial requires Python &gt;= 3.8.</p>
<p>To check your current Python environment, type in a terminal:</p>
<pre class=" language-python"><code class="prism  language-python">
$ python <span class="token operator">-</span><span class="token operator">-</span>version

Python <span class="token number">3.9</span><span class="token punctuation">.</span><span class="token number">5</span>

</code></pre>
<p>Mine is on version 3.9.5. If you have a deprecated version, please upgrade it at least to &gt;=3.8.</p>
<blockquote>
<p>💡 A best practice is to create a new python environment with Conda. In this workshop, we will not since we are creating a new linux environment that we will trash just after. But feel free to do it, especially with local installation.</p>
</blockquote>
<h2 id="step-3--set-up-a-postgresql-cluster">Step 3 : set up a PostgreSQL cluster</h2>
<p>For this workshop, we will use a PostreSQL cluster to store and transform our data.</p>
<p>PostgreSQL is an open source and community-based transactional database management system, widely used accross the world. Perfect for a workshop but also for production. It has not the flexibily of modern lakehouse such as Snowflake or BigQuery (compute and storage are linked for example, and information is stored in row format, not columnar) but can be relevant in many Business Intelligence use-cases where performance is not the main criteria.</p>
<p>To setup a new cluster, two solutions:</p>
<ul>
<li>
<p>Use a managed Cloud Product such as OVHcloud for PostreSQL (paid).</p>
</li>
<li>
<p>install yourself a PostgreSQL somewhere (eg. your computer, free).</p>
</li>
</ul>
<h3 id="option-1--launch-an-ovhcloud-postgresql-cluster">Option 1 : launch an OVHcloud PostgreSQL cluster</h3>
<p>We will go for a cloud product here:</p>
<ol>
<li>
<p>Go to OVHcloud control panel.</p>
</li>
<li>
<p>Go to Public Cloud section in the top menu.</p>
</li>
<li>
<p>Select your project or create a new one.</p>
</li>
</ol>
<p>If the left menu, select Databases then create a new one with these parameters:</p>
<ul>
<li>
<p><strong>Database type</strong>: PostgreSQL 14</p>
</li>
<li>
<p><strong>Plan</strong>: Essential (1 node)</p>
</li>
<li>
<p><strong>Region</strong>: as you wish</p>
</li>
<li>
<p><strong>Size of nodes</strong>: smallest one, like DB1-4</p>
</li>
<li>
<p><strong>Options / Network</strong>: Public network (open to internet access)</p>
</li>
</ul>
<p>Launch this database cluster.</p>
<p>Once this cluster is up and running, you will have to configure users and authorized IPs.</p>
<p>Go in <code>Users</code> tab, and create a new user. Copy his username and password safely.</p>
<p>Now go in <code>Authorized IPs</code> and add the IP <strong>0.0.0.0/0</strong>.</p>
<p>It’s a wildcard allowing any IP in the world.</p>
<blockquote>
<p>❗️ a Wildcard is useful for a workshop or troubleshooting, but not recommended at all for production. Anyone will be able to contact your cluster.</p>
</blockquote>
<h3 id="option-2--manual-installation-self-hosted">Option 2 : manual installation (self-hosted)</h3>
<p>If you opt for a manual installation, follow official instructions here: <a href="https://www.postgresql.org/download/">https://www.postgresql.org/download/</a>.</p>
<p>This workshop was tested with PostgreSQL 14.</p>
<p>Once installed, configure a new database.</p>
<p>You can find alternative websites with detailled tutorials like <a href="https://www.postgresqltutorial.com/postgresql-getting-started/">https://www.postgresqltutorial.com/postgresql-getting-started/</a> to guide you through the steps.</p>
<h1 id="part-2-setup-dbt">Part 2: Setup DBT</h1>
<p>Great! OVer the part 1, we setup a Python environment and a datawarehouse.</p>
<p>It’s now time to install the first data software, DBT!</p>
<h2 id="what-the-hell-is-dbt-">What the hell is DBT ?</h2>
<p>Good question! DBT is the acronym of Data Build Tool and was created in 2016 by some folks of RJMetrics.</p>
<p>Here is quote from their official website: <em>dbt is a transformation workflow that helps you get more work done while producing higher quality results. You can use dbt to modularize and centralize your analytics code, while also providing your data team with guardrails typically found in software engineering workflows. Collaborate on data models, version them, and test and document your queries before safely deploying them to production, with monitoring and visibility</em>.</p>
<p>DBT is an answer to all team facing analytics issues. <em>Who made a change on this query?. Where can I find explanation about this data? How can i rollback to the queries made 1 week ago? How can I test safely before running is in production?</em>. You see what I mean. Artisanal mode.</p>
<p>If I try to sum-up, with data analytics your start with multiple data sources and end up with results, like reports or dashboard. Between sources and results, the workflows you put has to be structured, documented, collaborative, and shared safely.</p>
<p>We already do that widely for software. If you develop a software, you will push you code on Git, collaborate with branches, do some versioning, document you code directly, build CI/CD pipelines, …</p>
<p>Why not doing the same with data analytics ? Software engineering is here since long, now let’s embrace analytics engineering!</p>
<p>DBT is one of the answer :) Don’t hesitate to read more with the <a href="https://docs.getdbt.com/community/resources/viewpoint">DBT viewpoint</a>.</p>
<h2 id="install-dbt">Install DBT</h2>
<blockquote>
<p>💡 check official documentation for complete guidance : <a href="https://docs.getdbt.com/docs/get-started/installation">https://docs.getdbt.com/docs/get-started/installation</a>.</p>
</blockquote>
<p>DBT comes in two versions:</p>
<ul>
<li>
<p>DBT Core, that you can install yourself as self-hosted. It’s free and open source.</p>
</li>
<li>
<p>DBT Cloud, where you will get a managed version of DBT, with more features. It’s a paid plan.</p>
</li>
</ul>
<p>We will install <strong>DBT Core</strong> in our case.</p>
<p>Since we will use DBT with PostgreSQL, we will install DBT Core and DBT PostgreSQL connector at once.</p>
<p>Go in you Python terminal and type:</p>
<pre class=" language-python"><code class="prism  language-python">
<span class="token comment"># Update PIP to the latest version</span>

$ python <span class="token operator">-</span>m pip install <span class="token operator">-</span><span class="token operator">-</span>upgrade pip

<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>

  

<span class="token comment"># Install DBT Core and DBT PostgreSQL connector at once</span>

$ pip install dbt<span class="token operator">-</span>postgres

<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>

  

<span class="token comment"># Verify versions</span>

$ dbt <span class="token operator">-</span><span class="token operator">-</span>version

Core<span class="token punctuation">:</span>

<span class="token operator">-</span> installed<span class="token punctuation">:</span> <span class="token number">1.3</span><span class="token punctuation">.</span><span class="token number">1</span>

<span class="token operator">-</span> latest<span class="token punctuation">:</span> <span class="token number">1.3</span><span class="token punctuation">.</span><span class="token number">1</span> <span class="token operator">-</span> Up to date!

  

Plugins<span class="token punctuation">:</span>

<span class="token operator">-</span> postgres<span class="token punctuation">:</span> <span class="token number">1.3</span><span class="token punctuation">.</span><span class="token number">1</span> <span class="token operator">-</span> Up to date!

</code></pre>
<h2 id="create-your-first-project">Create your first project</h2>
<p>DBT works with projects, containing your configuration, SQL models, and much more.</p>
<p>Create your first one with <code>DBT init</code>:</p>
<pre class=" language-python"><code class="prism  language-python">
$ dbt init quick_workshop

<span class="token number">09</span><span class="token punctuation">:</span><span class="token number">47</span><span class="token punctuation">:</span><span class="token number">12</span> Running <span class="token keyword">with</span> dbt<span class="token operator">=</span><span class="token number">1.3</span><span class="token punctuation">.</span><span class="token number">1</span>

<span class="token number">09</span><span class="token punctuation">:</span><span class="token number">47</span><span class="token punctuation">:</span><span class="token number">12</span> Creating dbt configuration folder at <span class="token operator">/</span>workspace<span class="token operator">/</span><span class="token punctuation">.</span>dbt

Which database would you like to use?

<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> postgres

<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>

Your new dbt project <span class="token string">"quick_workshop"</span> was created!

</code></pre>
<p>2 new folder appeared in your directory, <code>Logs</code>and <code>quick_workshop</code>.</p>
<p>Move to this project folder with your terminal:</p>
<pre class=" language-python"><code class="prism  language-python">
<span class="token comment"># Go to new project folder</span>

$ cd quick_workshop

  

<span class="token comment"># list content files</span>

$ ls

README<span class="token punctuation">.</span>md analyses dbt_project<span class="token punctuation">.</span>yml macros models seeds snapshots tests

</code></pre>
<p>Congrats, your first project is created!</p>
<p>Quick descriptions about these directories:</p>
<p>| Directory | Description |</p>
<p>| — | — |</p>
<p>| analyses | where you can compile SQL queries, more often for later usage as analytical queries |</p>
<p>| macros | blocks of code that you can reause multiple times |</p>
<p>| models | where you put your code. 1 file = 1 model, and you code quite often transform raw data in datasets or intermediate trandsformations |</p>
<p>| seeds | Static CSV data that you can load via DBT |</p>
<p>| snapshots | when you capture the state of your data tables, to refer to it later |</p>
<p>| tests | SQL/Python tests you can run to validate your data or models. |</p>
<p>When you initialize a DBT project, there is also the file <code>dbt-project.yml</code>, which contains useful parameters.</p>
<p>A name, a version, models to build but also a <strong>profile</strong> to use.</p>
<p>As explained before, <strong>DBT does not process data itself</strong>. There is no compute, no “power”. DBT is linked to something doing transformation tasks. Most famous ones are PostreSQL, BigQuery, Snowflake, Spark, …</p>
<p>Here in profile, you can redirect this project to a profile to use.</p>
<p>Keep it like the screenshot aka <code>quick_workshop</code>.</p>
<p><img src="img/dbtproject.png" alt="AI Notebook - Terminal button"></p>
<h2 id="connect-dbt-to-your-postgresql-cluster">Connect DBT to your PostgreSQL cluster</h2>
<p>DBT connects to your datawarehouse using a profile, which is a <code>.yml</code> file created during our first project init. You were notified about his creation during the <code>dbt init</code>in the previous step, and his directoy path were also shown.</p>
<p>Let’s edit this file:</p>
<ol>
<li>
<p>Open your Python terminal.</p>
</li>
<li>
<p>Open your profile file, in our case it’s in <code>/workspace/.dbt/profiles.yml</code>.</p>
</li>
</ol>
<pre class=" language-python"><code class="prism  language-python">
<span class="token comment"># Open profile.yml with your preferred code editor such as Vim/nano/...</span>

$ nano <span class="token operator">/</span>workspace<span class="token operator">/</span><span class="token punctuation">.</span>dbt<span class="token operator">/</span>profiles<span class="token punctuation">.</span>yml

</code></pre>
<p>By default, your profile should look like this:</p>
<pre><code>
quick_workshop:

outputs:

  

dev:

type: postgres

threads: [1 or more]

host: [host]

port: [port]

user: [dev_username]

pass: [dev_password]

dbname: [dbname]

schema: [dev_schema]

  

prod:

type: postgres

threads: [1 or more]

host: [host]

port: [port]

user: [prod_username]

pass: [prod_password]

dbname: [dbname]

schema: [prod_schema]

  

target: dev

</code></pre>
<p>Replace values with your PostgreSQL cluster informations.</p>
<p>In our case, with an OVHcloud PostgreSQL cluster:</p>
<pre><code>
quick_workshop:

outputs:

  

dev:

type: postgres

threads: 4

host: postgresql-5c66e728-o90e8df85.database.cloud.ovh.net

port: 20184

user: bastien

pass: hmTiDdN0y*********

dbname: defaultdb

schema: development

sslmode: require

  

prod:

type: postgres

threads: 4

host: postgresql-5c66e728-o90e8df85.database.cloud.ovh.net

port: 20184

user: bastien

pass: hmTiDdN0y*********

dbname: defaultdb

schema: production

sslmode: require

  

target: dev

</code></pre>
<p>Notice few things :</p>
<ul>
<li>
<p>You can get a development and a production environment, or even more. Here, in the target, we ONLY interfact with dev.</p>
</li>
<li>
<p>You can differenciate the schemas used if you want to. We did it there, with the same database clsuter BUT two schemas.</p>
</li>
<li>
<p>SSL mode is required for OVHcloud services, but not if you are running PostgreSQL locally.</p>
</li>
<li>
<p>1 thread means no parralelization of task. Default is 4. it mean DBT will run 4 jobs in parralel.</p>
</li>
</ul>
<p>A best practice is to fully separate development and production environnment.</p>
<p>First to avoid human mistakes such as data deletion, but also to isolate compute resources.</p>
<p>Having an splitted dev platform will allow you to run intensive queries without being scared to “disturb” production performances.</p>
<p>Save this configuration and close this profile.yml file.</p>
<h2 id="test-your-environment">Test your environment</h2>
<p>First, run a debug:</p>
<pre class=" language-python"><code class="prism  language-python">
quick_workshop$ dbt debug

</code></pre>
<p><img src="img/dbtdebug.png" alt="AI Notebook - Terminal button"></p>
<p>If all checks have passed, we are good! DBT is able to find your configuration and able to connect to PostgreSQL.</p>
<h2 id="perform-a-first-dummy-dbt-run">Perform a first dummy DBT run</h2>
<p>During the project initialization, DBT pushed examples inside the <code>models</code> folder.</p>
<p>When your perform a DBT run, DBT looks for models inside this folder and will run them.</p>
<blockquote>
<p>💡 if you go back to the pevious step, you will notice at the end of your <code>dbt_project.yml</code> configuration that we asked to build models inside /models/examples.</p>
</blockquote>
<p>Perform your first run:</p>
<pre class=" language-python"><code class="prism  language-python">
quick_workshop$ dbt run

<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>

</code></pre>
<p><img src="img/dbtrun.png" alt="DBT run"></p>
<p>As shown in the result, 2 models were completed successfully.</p>
<p>These models are dummy ones. You can check what’s inside by browing into <code>/models/examples</code> and open the <code>.SQL</code> files.</p>
<p>In short, the first SQL model will perform a SELECT on a fake source data, and the second DBT model will perform a SELECT on top of the first SQL model.</p>
<p>The good thing is, DBT is able to materialize results. so you can reuse your results easily (like, hmmm, for BI reports maybe ?😉). It was the case for these two models.</p>
<p>The major materialization are <code>views</code>and second ones are <code>tables</code>.</p>
<p>A <code>view</code> can be seen as a virtual table. every time you ask for it, the model is rebuilt. It does not store data in your datawarehouse but will virtually aggregate information to create something to <em>view</em>.</p>
<p>A <code>table</code> will create a real table in your datawarehouse. You wrote something on disks.</p>
<p>Both have pros and cons, and the power of DBT is that you can specify this materialization directly in your models.</p>
<p>As an example, if I select <code>table</code> here is what i can see inside my PostgreSQL cluster now:</p>
<p><img src="img/pgadmin1.png" alt="PgAdmin - view of dummy project"></p>
<p>Now that we runned our first DBT run, let’s build our own models!</p>
<blockquote>
<p>💡 More information and more materialization options are available with DBT: <a href="https://docs.getdbt.com/docs/build/materializations">https://docs.getdbt.com/docs/build/materializations</a>.</p>
</blockquote>
<h1 id="part-3-ingest-data-badly">PART 3: ingest data (badly)</h1>
<p>Well done! You DBT project is now ready to be used. Time to play with data!</p>
<blockquote>
<p>💡 Usually you don’t need to bring fake data like this, because you already have something. But hey it’s a workshop :smik:. If you want to extend this workshop, I recommend to ingest data with open source tools such as <strong>Airbyte</strong> or <strong>Meltano</strong>. Both can also be self-hosted or provided as SaaS offers.</p>
</blockquote>
<h2 id="about-dbt-and-seeds">About DBT and seeds</h2>
<p>DBT allows CSV data ingestion, called <code>seeds</code> (remember the <em>seeds</em> folder?).</p>
<p>Best practive is to use <code>seeds</code> when you need to control static and versionned data.</p>
<p>Imagine that you are running everytime the same analysis for your business, but you want to exclude a list of 20 internals account. How ? Well, by using seeds.</p>
<p>Seeds workflow is:</p>
<ol>
<li>
<p>add CSV files into your <em>quick-workshop/seeds/</em> folder.</p>
</li>
<li>
<p>run the <code>dbt seed</code> command</p>
</li>
<li>
<p>CSV files are loaded as tables inside your datawarehouse.</p>
</li>
<li>
<p>if you modify your CSV by adding lines, the tables will be updated during the need <code>dbt seed</code>.</p>
</li>
</ol>
<blockquote>
<p>💡 More information and more options: <a href="https://docs.getdbt.com/docs/build/seeds">https://docs.getdbt.com/docs/build/seeds</a>. For example you can modify the <code>seeds</code>default directory, or specify a column datatype instead of betting on autoselection.</p>
</blockquote>
<h2 id="ingest-fake-data">Ingest fake data</h2>
<blockquote>
<p>ℹ️ For easiness, this fake data is inspired from official dbt example called <code>jaffle_shop</code>but with extra columns for better use-cases with Metabase (more fields, and more lines). Full credits goes to this <a href="https://github.com/dbt-labs/jaffle_shop">official DBT example repository</a>.</p>
</blockquote>
<p>For this workshop, we will tweak the use of <code>seed</code> to import fake data.</p>
<p><strong>Download</strong> the fake data provided in this workshop Github repository.</p>
<p>It consist of 3 CSV files, wike fake data (generated with <a href="http://www.Mockaroo.com">www.Mockaroo.com</a>).</p>
<p>From a entity relationship diagram (ERD) point of view, data is linked like this:</p>
<p><img src="img/fakedata.schema.png" alt="Data ERD"></p>
<p><strong>Copy</strong> these CSV files inside the <code>quick_workshop/seeds</code> folder.</p>
<p>Now run a <code>DBT seed</code>:</p>
<pre class=" language-python"><code class="prism  language-python">
quick_workshop$ dbt seed

<span class="token number">14</span><span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">29</span> Running <span class="token keyword">with</span> dbt<span class="token operator">=</span><span class="token number">1.3</span><span class="token punctuation">.</span><span class="token number">1</span>

<span class="token number">14</span><span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">29</span> Found <span class="token number">2</span> models<span class="token punctuation">,</span> <span class="token number">4</span> tests<span class="token punctuation">,</span> <span class="token number">0</span> snapshots<span class="token punctuation">,</span> <span class="token number">0</span> analyses<span class="token punctuation">,</span> <span class="token number">289</span> macros<span class="token punctuation">,</span> <span class="token number">0</span> operations<span class="token punctuation">,</span> <span class="token number">3</span> seed files<span class="token punctuation">,</span> <span class="token number">0</span> sources<span class="token punctuation">,</span> <span class="token number">0</span> exposures<span class="token punctuation">,</span> <span class="token number">0</span> metrics

<span class="token number">14</span><span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">29</span>

<span class="token number">14</span><span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">30</span> Concurrency<span class="token punctuation">:</span> <span class="token number">4</span> threads <span class="token punctuation">(</span>target<span class="token operator">=</span><span class="token string">'dev'</span><span class="token punctuation">)</span>

<span class="token number">14</span><span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">30</span>

<span class="token number">14</span><span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">30</span>  <span class="token number">1</span> of <span class="token number">3</span> START seed <span class="token builtin">file</span> development<span class="token punctuation">.</span>raw_customers <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span>RUN<span class="token punctuation">]</span>

<span class="token number">14</span><span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">30</span>  <span class="token number">1</span> of <span class="token number">3</span> OK loaded seed <span class="token builtin">file</span> development<span class="token punctuation">.</span>raw_customers <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span>INSERT <span class="token number">100</span>  <span class="token keyword">in</span>  <span class="token number">0.</span>31s<span class="token punctuation">]</span>

<span class="token number">14</span><span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">30</span>  <span class="token number">2</span> of <span class="token number">3</span> START seed <span class="token builtin">file</span> development<span class="token punctuation">.</span>raw_orders <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span>RUN<span class="token punctuation">]</span>

<span class="token number">14</span><span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">32</span>  <span class="token number">2</span> of <span class="token number">3</span> OK loaded seed <span class="token builtin">file</span> development<span class="token punctuation">.</span>raw_orders <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span>INSERT <span class="token number">1000</span>  <span class="token keyword">in</span>  <span class="token number">1.</span>72s<span class="token punctuation">]</span>

<span class="token number">14</span><span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">32</span>  <span class="token number">3</span> of <span class="token number">3</span> START seed <span class="token builtin">file</span> development<span class="token punctuation">.</span>raw_payments <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span>RUN<span class="token punctuation">]</span>

<span class="token number">14</span><span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">33</span>  <span class="token number">3</span> of <span class="token number">3</span> OK loaded seed <span class="token builtin">file</span> development<span class="token punctuation">.</span>raw_payments <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span>INSERT <span class="token number">1000</span>  <span class="token keyword">in</span>  <span class="token number">1.</span>36s<span class="token punctuation">]</span>

<span class="token number">14</span><span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">33</span>

<span class="token number">14</span><span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">33</span> Finished running <span class="token number">3</span> seeds <span class="token keyword">in</span>  <span class="token number">0</span> hours <span class="token number">0</span> minutes <span class="token operator">and</span>  <span class="token number">3.66</span> seconds <span class="token punctuation">(</span><span class="token number">3.</span>66s<span class="token punctuation">)</span><span class="token punctuation">.</span>

<span class="token number">14</span><span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">33</span>

<span class="token number">14</span><span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">33</span> Completed successfully

<span class="token number">14</span><span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">33</span>

<span class="token number">14</span><span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">33</span> Done<span class="token punctuation">.</span> PASS<span class="token operator">=</span><span class="token number">3</span> WARN<span class="token operator">=</span><span class="token number">0</span> ERROR<span class="token operator">=</span><span class="token number">0</span> SKIP<span class="token operator">=</span><span class="token number">0</span> TOTAL<span class="token operator">=</span><span class="token number">3</span>

</code></pre>
<p>Data is now imported! Created inside 3 tables into your datawarehouse.</p>
<p>when taking a look with a PostgreSQL client like PgAdmin, you can see three new tables :</p>
<p><img src="img/pgadmin2.png" alt="PgAdmin - new tables"></p>
<p>Data is loaded, it’s now time to generate analytics-ready views and tables!</p>
<h1 id="part-4-transform-data-with-dbt-models">Part 4: transform data with DBT models</h1>
<p>The current data is exhaustive but splitted in multiple tables.</p>
<p>You have the users, the orders, the payments.</p>
<p>How can you get more actionable views? for example:</p>
<ul>
<li>
<p>for each customer, a total amount of orders.</p>
</li>
<li>
<p>the last order from each customer.</p>
</li>
<li>
<p>revenues per country.</p>
</li>
<li>
<p>…</p>
</li>
</ul>
<p>Without DBT, you can get those answers with classic SQL syntax, directly by querying PostgreSQL</p>
<p>It will work fine. But wait.</p>
<p>Imagine that you don’t have one query but a dozen one, nested together like pipelies (first <em>anonymize data</em>, then <em>remove fraud</em>, then <em>calculate revenues</em>, …) not punctually but with recurrence, with vast amount of data, share your method globally and with control, with versionning, tests, generated documentation and co?</p>
<p>That’s when DBT is relevant, bringing you transformation workflows and control over SQL queries or Python code.</p>
<h2 id="create-your-first-sql-model">Create your first SQL model</h2>
<p>Browse your <em>quick_workshop/models/</em> directory.</p>
<p>Delete the <code>example</code> folder, not required anymore.</p>
<p>Create a new file named <code>customers.sql</code>. Open this file and copy the code below:</p>
<pre class=" language-sql"><code class="prism  language-sql">
<span class="token keyword">with</span> customers <span class="token keyword">as</span> <span class="token punctuation">(</span>

  

<span class="token keyword">select</span>

id <span class="token keyword">as</span> customer_id<span class="token punctuation">,</span>

first_name<span class="token punctuation">,</span>

last_name<span class="token punctuation">,</span>

email<span class="token punctuation">,</span>

country

  

<span class="token keyword">from</span> {{ ref<span class="token punctuation">(</span><span class="token string">'raw_customers'</span><span class="token punctuation">)</span> }}

  

<span class="token punctuation">)</span><span class="token punctuation">,</span>

  

orders <span class="token keyword">as</span> <span class="token punctuation">(</span>

  

<span class="token keyword">select</span>

id <span class="token keyword">as</span> order_id<span class="token punctuation">,</span>

customer_id<span class="token punctuation">,</span>

order_date<span class="token punctuation">,</span>

order_item<span class="token punctuation">,</span>

order_status

  

<span class="token keyword">from</span> {{ ref<span class="token punctuation">(</span><span class="token string">'raw_orders'</span><span class="token punctuation">)</span> }}

  

<span class="token punctuation">)</span><span class="token punctuation">,</span>

  

customer_orders <span class="token keyword">as</span> <span class="token punctuation">(</span>

  

<span class="token keyword">select</span>

customer_id<span class="token punctuation">,</span>

  

<span class="token function">min</span><span class="token punctuation">(</span>order_date<span class="token punctuation">)</span> <span class="token keyword">as</span> first_order_date<span class="token punctuation">,</span>

<span class="token function">max</span><span class="token punctuation">(</span>order_date<span class="token punctuation">)</span> <span class="token keyword">as</span> most_recent_order_date<span class="token punctuation">,</span>

<span class="token function">count</span><span class="token punctuation">(</span>order_id<span class="token punctuation">)</span> <span class="token keyword">as</span> number_of_orders

  

<span class="token keyword">from</span> orders

  

<span class="token keyword">group</span> <span class="token keyword">by</span>  <span class="token number">1</span>

  

<span class="token punctuation">)</span><span class="token punctuation">,</span>

  

final <span class="token keyword">as</span> <span class="token punctuation">(</span>

  

<span class="token keyword">select</span>

customers<span class="token punctuation">.</span>customer_id<span class="token punctuation">,</span>

customers<span class="token punctuation">.</span>first_name<span class="token punctuation">,</span>

customers<span class="token punctuation">.</span>last_name<span class="token punctuation">,</span>

customers<span class="token punctuation">.</span>country<span class="token punctuation">,</span>

customer_orders<span class="token punctuation">.</span>first_order_date<span class="token punctuation">,</span>

customer_orders<span class="token punctuation">.</span>most_recent_order_date<span class="token punctuation">,</span>

<span class="token keyword">coalesce</span><span class="token punctuation">(</span>customer_orders<span class="token punctuation">.</span>number_of_orders<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">as</span> number_of_orders

  

<span class="token keyword">from</span> customers

  

<span class="token keyword">left</span> <span class="token keyword">join</span> customer_orders <span class="token keyword">using</span> <span class="token punctuation">(</span>customer_id<span class="token punctuation">)</span>

  

<span class="token punctuation">)</span>

  

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> final

</code></pre>
<p><strong>Save</strong> this file.</p>
<p>Few explanations about this code sample:</p>
<ul>
<li>
<p>we start by selecting few columns for the Table “raw_customers”.</p>
</li>
<li>
<p>We do the same from the table “raw_orders”</p>
</li>
<li>
<p>We then create new columns, respectively the first order date, the most recent, and the total or orders</p>
</li>
<li>
<p>we build a final query regrouping columns from multiple parts.</p>
</li>
<li>
<p>finally we select everything (*) fron this query.</p>
</li>
<li>
<p>SQL info : the coalesce() function give you the first <code>NOT NULL</code> result. so here if <code>number_of_orders</code>is null, it will replace it by zero to avoid empty cells.</p>
</li>
</ul>
<h3 id="reconfigure-your-project">Reconfigure your project</h3>
<p>During DBT project initialization, DBT was configured to run models only from <code>/example</code> directory.</p>
<p>Current configuration inside <code>dbt_project.yml</code>:</p>
<pre><code>
models:

quick_workshop:

examples

+materialized: table

</code></pre>
<p>Since we deleted the <em>quick_workshop/models/examples</em> directory, we have to modify this part.</p>
<p>Modify the file <code>dbt_project.yml</code>and put this new configuration instead:</p>
<pre><code>
models:

quick_workshop:

materialized: table

</code></pre>
<p>It will now take into account our SQL files pushed at the <em>root</em> of <em>quick_workshop/models</em>.</p>
<h3 id="run-dbt">Run DBT</h3>
<p>Now let’s run DBT. It will browse the <em>quick_workshop/models</em> directory:</p>
<pre class=" language-python"><code class="prism  language-python">
quick_workshop$ dbt run

<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">:</span><span class="token number">53</span> Running <span class="token keyword">with</span> dbt<span class="token operator">=</span><span class="token number">1.3</span><span class="token punctuation">.</span><span class="token number">1</span>

<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">:</span><span class="token number">53</span> Found <span class="token number">1</span> model<span class="token punctuation">,</span> <span class="token number">0</span> tests<span class="token punctuation">,</span> <span class="token number">0</span> snapshots<span class="token punctuation">,</span> <span class="token number">0</span> analyses<span class="token punctuation">,</span> <span class="token number">289</span> macros<span class="token punctuation">,</span> <span class="token number">0</span> operations<span class="token punctuation">,</span> <span class="token number">3</span> seed files<span class="token punctuation">,</span> <span class="token number">0</span> sources<span class="token punctuation">,</span> <span class="token number">0</span> exposures<span class="token punctuation">,</span> <span class="token number">0</span> metrics

<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">:</span><span class="token number">53</span>

<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">:</span><span class="token number">53</span> Concurrency<span class="token punctuation">:</span> <span class="token number">4</span> threads <span class="token punctuation">(</span>target<span class="token operator">=</span><span class="token string">'dev'</span><span class="token punctuation">)</span>

<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">:</span><span class="token number">53</span>

<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">:</span><span class="token number">54</span>  <span class="token number">1</span> of <span class="token number">2</span> START sql table model development<span class="token punctuation">.</span>customers <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span>RUN<span class="token punctuation">]</span>

<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">:</span><span class="token number">54</span>  <span class="token number">1</span> of <span class="token number">2</span> OK created sql table model development<span class="token punctuation">.</span>customers <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span>SELECT <span class="token number">100</span>  <span class="token keyword">in</span>  <span class="token number">0.</span>11s<span class="token punctuation">]</span>

<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">:</span><span class="token number">54</span>

<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">:</span><span class="token number">54</span> Finished running <span class="token number">1</span> table model <span class="token keyword">in</span>  <span class="token number">0</span> hours <span class="token number">0</span> minutes <span class="token operator">and</span>  <span class="token number">0.56</span> seconds <span class="token punctuation">(</span><span class="token number">0.</span>11s<span class="token punctuation">)</span><span class="token punctuation">.</span>

<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">:</span><span class="token number">54</span>

<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">:</span><span class="token number">54</span> Completed successfully

<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">:</span><span class="token number">54</span>

<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">:</span><span class="token number">54</span> Done<span class="token punctuation">.</span> PASS<span class="token operator">=</span><span class="token number">1</span> WARN<span class="token operator">=</span><span class="token number">0</span> ERROR<span class="token operator">=</span><span class="token number">0</span> SKIP<span class="token operator">=</span><span class="token number">0</span> TOTAL<span class="token operator">=</span><span class="token number">1</span>

</code></pre>
<p>Model was run successfully and table also created.</p>
<h3 id="check-the-result-in-your-datawarehouse">Check the result in your datawarehouse</h3>
<p>What we are waiting for, is a new table created in our datawarehouse, countaining our aggregated data.</p>
<p>Good news this is exactly what we have 😉.</p>
<p><img src="img/pgadmin3.png" alt="PgAdmin - new tables"></p>
<h2 id="exercise-1-build-another-dbt-model-wink">Exercise 1: build another DBT model 😉</h2>
<p>Now that we discovered a bit more how DBT works, let’s try to build another model yourself.</p>
<p>Our Marketing team would love to target more accurately some geographical areas, and want to create a country dashboard.</p>
<p>You have to create a new <strong>table</strong> in our datawarehouse, analyzing revenues per country.</p>
<p>Also, we only want to summarize revenues for orders where status is <strong>true</strong> (meaning it’s paid).</p>
<p>The table columns should be like this:</p>
<p>| Country | Total of orders | Total revenue |</p>
<p>|---------|-----------------|---------------|</p>
<p>| France | 37 | 2530 |</p>
<p>| … | … | … |</p>
<p>Create this new table and save it inside <em>quick_workshop/models/countries.sql</em>.</p>
<blockquote>
<p>💡 Hint: required data is splitted into three tables (customers, orders, payment). Time to learn about SQL JOIN 😉.</p>
</blockquote>
<p>If you are blocked, you can find the solution in this Github repository, in the <em>exercises</em> folder.</p>
<h2 id="exercise-2-remove-suspicious-accounts">Exercise 2: remove suspicious accounts</h2>
<p>Our Data team is convinced that we need to remove all emails ending with <strong>@facebook.com</strong>, because 100% of the time it’s fraudulous accounts.</p>
<p>The goal here is to skip some irrelevant data that are ingested regularly.</p>
<p>They also told us that they are investigating, but other emails system will have to be banned in the future.</p>
<p>How do you proceed ?</p>
<p>Same, if you are blocked, a solution can be found in this repository!</p>
<h2 id="generate-documentation">Generate documentation</h2>
<p>Let’s get back to the topic of building a first BI Platform.</p>
<p>What the point of having data tables without a clean documentation? None. Over time, a good documentation is key.</p>
<p>Code commenting is a best practice in software development, data and queries documentation should also become an acceptence criteria for analytics engineering.</p>
<p>What if we could generate documentation on the fly and serve it to everyone, for, by example, spread it to the data team?</p>
<p>Good news it’s included in DBT! It provide few things:</p>
<ul>
<li>
<p>Ability to document your models directly in your repository (inside your models files, but also in separated documents)</p>
</li>
<li>
<p>Ability to generate a clean HTML documentation</p>
</li>
<li>
<p>Ability to serve this documentation on a web server.</p>
</li>
</ul>
<blockquote>
<p>💡 More information about documentation: <a href="https://docs.getdbt.com/docs/collaborate/documentation">https://docs.getdbt.com/docs/collaborate/documentation</a></p>
</blockquote>
<p>Go back to your Python terminal and type:</p>
<pre class=" language-python"><code class="prism  language-python">
$ dbt docs generate

<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>

$ dbt docs serve <span class="token operator">-</span><span class="token operator">-</span>port <span class="token number">8001</span>

</code></pre>
<p>Your documentation is now <strong>generated as HTML</strong>, and <strong>hosted</strong>!</p>
<p>Generated files are pushed inside <em>quick_workshop/target</em>.</p>
<p>If you are running DBT locally, go to <a href="http://localhost:8001">http://localhost:8001</a>.</p>
<p>If you are using OVHcloud AI Notebook, it support port forwarding. Take the link of you notebook and add the port in the URL as shown below :</p>
<p><strong>URL example</strong> : <a href="https://f746650a-e99c-4ab5-b7e4-5d79c32cb134.notebook.gra.ai.cloud.ovh.net/lab/tree/quick_workshop">https://f746650a-e99c-4ab5-b7e4-5d79c32cb134.notebook.gra.ai.cloud.ovh.net/lab/tree/quick_workshop</a></p>
<p><strong>Access port 8001</strong>: <a href="https://f746650a-e99c-4ab5-b7e4-5d79c32cb134-8001.notebook.gra.ai.cloud.ovh.net">https://f746650a-e99c-4ab5-b7e4-5d79c32cb134-8001.notebook.gra.ai.cloud.ovh.net</a></p>
<p><img src="img/schema.png" alt="DBT run"></p>
<h2 id="thats-a-one-small-step-for-man-but...">That’s a one small step for man, but…</h2>
<p>Congrats, you now had a first model running, humbly trying to detail few DBT features.</p>
<p>Typical DBT workflows includes more than one source of data, quite often dozens of models, creating views, tables, and all of them are nested together. With DBT test, and DBT macros, CI/CD, and Git synchronization.</p>
<p>Again, you can see it as software develooment best practices, but ported to analytics code. No more no less!</p>
<p>The DBT part is over for this workshop. The last part will engage data visualization!</p>
<h1 id="part-5--visualize-your-data-with-metabase">Part 5 : Visualize your data with Metabase</h1>
<h2 id="why-metabase-is-so-cool-">Why Metabase is so cool ?</h2>
<p>Similarly to DBT, <a href="https://www.metabase.com">Metabase</a> is an open source software provided as a paid cloud version or free self-hosted.</p>
<p>Metabase is awesome in multiple ways. It can be defined as a BI tools, with two main part :</p>
<ul>
<li>
<p>A query tool, with wysiwyg editor and SQL query support.</p>
</li>
<li>
<p>A dashboard tool, with a well polished and intuitive interface.</p>
</li>
</ul>
<p>Metabase <strong>does not store your data</strong>, but they will store your queries syntax and metadata required to build your dashboards. I guess that the name <em>meta(data)base</em> comes from this point 😉.</p>
<p>By default, for the self-hosted version, they store this data inside a SQLite database but you can opt for your own SQL database as a backend (much better for production).</p>
<h2 id="install-metabase">Install Metabase</h2>
<p>For this tutorial, we will use the self hosted version.</p>
<p>Metabase can be installed from multiples ways, as explained in their official documentation: java JAR file, Docker image, or from source.</p>
<h3 id="option-1-install-metabase-with-desktop-jar-version">Option 1: install metabase with desktop JAR version</h3>
<p>Metabase is proposed a a java file (JAR). If you computer has a Java Runtime &gt;=8 (JRE), such as MAcOS or most Linux distributions, it’s the easiest way to try it.</p>
<p>Express guide :</p>
<ol>
<li>
<p>download Metabase from <a href="https://www.metabase.com/docs/latest/installation-and-operation/installing-metabase">https://www.metabase.com/docs/latest/installation-and-operation/installing-metabase</a></p>
</li>
<li>
<p>push it in a folder called for example “metabase”. because it will generate files</p>
</li>
<li>
<p>run it by double-click or type “java -jar metabase.jar” in a terminal to get logs (it it doesn’t work).</p>
</li>
</ol>
<h3 id="option-2-install-metabase-via-docker-in-the-cloud">Option 2: Install metabase via Docker in the cloud</h3>
<p>If you are more into Docker or Source installation, follow their official tutorials</p>
<p><a href="https://www.metabase.com/docs/latest/">https://www.metabase.com/docs/latest/</a></p>
<p>This is the option selected for this workshop on my side, by doing this:</p>
<ol>
<li>
<p>I’m not admin on my professional laptop, so I launched an OVHcloud virtual marchine (instance).</p>
</li>
<li>
<p>Go in OVHcloud Control panel / Public Cloud / Instance / new</p>
</li>
<li>
<p>create a new instance, model Sandbox S1-2 (the cheapest) with latest Ubuntu (22.10 at the time) and public network (you need a SSH key)</p>
</li>
<li>
<p>Once Created, follow official Metabase instructions from their website documentation</p>
</li>
</ol>
<p>If you followed official instrutions, shortly after installation you can connect to your metabase instance via &lt;http://&lt;your_ip&gt;:3001&gt; and be reidrected to the welcome screen.</p>
<h2 id="connect-your-datawarehouse-to-metabase">Connect your datawarehouse to metabase</h2>
<p>Metabase comes with a large choice of official data sources connectors, but also partners and community-based ones.</p>
<p>MySQL, PostgreSQL, MongoDB, BigQuery, Snowflake, Apache Spark, Google Analytics, … but also Hydra, DuckDB.</p>
<blockquote>
<p>ℹ️ List of official connectors: <a href="https://www.metabase.com/data_sources/">https://www.metabase.com/data_sources/</a>.</p>
</blockquote>
<p>Once installed, click on <code>Get started</code>, fill the information and add a PostgreSQL source.</p>
<p>For an OVHcloud for PostgreSQL database, fill is at below (be carefull, SSL is in <code>require</code> mode):</p>
<p><img src="img/metabase1.png" alt="Metabase - add PostgreSQL 1"></p>
<p><img src="img/metabase2.png" alt="Metabase - add PostgreSQL 2"></p>
<p>If your connector is correctly configured, you should be able to browser you data through the left menu.</p>
<p>Metabase provides a sample database, and one that we called <code>Workshop</code>.</p>
<p><img src="img/metabase3.png" alt="Metabase - browse data"></p>
<p>If you browse this data, you will eventually see all the table generated via DBT.</p>
<p>The ones with raw data, and the ones generated (<code>customers</code> and <code>countries</code>).</p>
<p>Metabase built a handy feature called X-ray (the lightning strike), generating automatically some reports about a specific table.</p>
<p>Try it with your customers table for example :</p>
<p><img src="img/metabase4.png" alt="Metabase - xray"></p>
<h2 id="build-awesome-dashboards">Build awesome dashboards</h2>
<p>When you query you data, Metabase allows you to save your query and his visualisation.</p>
<p>A Dashboard is composed to saved visualisation and filtering options.</p>
<p>You can see a dashboard as virtual collection of previously-made visualizations.</p>
<p>So, you start by querying the data, then save the results and finally add them into dashboards.</p>
<h3 id="query-your-data">Query your data</h3>
<p>On the top right menu, click on the <code>+ NEW</code>button and select <code>Question</code>.</p>
<p>Pick the <em>/Workshop/customers/</em> data table. it will open a visual interface allowing you to filter, sort, limit your queries, as classic SQL queries. You also have advanced feature like SQL join, …</p>
<p>This interface is pretty straightforward, play a bit with the tool.</p>
<p>As an example, do a <code>Count of rows</code> by <code>country</code>, then click on the small <code>Preview</code>button on the right.</p>
<p><img src="img/metabase6.png" alt="Metabase - query editor"></p>
<blockquote>
<p>💡 on the <code>+ NEW</code> button, you can also create a new <strong>SQL query via code editor</strong>. You can also create <strong>Metabase models</strong>, like in DBT. you have the ability to synchronize your DBT models and documentation with Metabase via extra python package such as <a href="https://github.com/gouline/dbt-metabase">dbt-metabase</a>.</p>
</blockquote>
<h3 id="add-a-visualization-to-the-dashboard">Add a visualization to the dashboard</h3>
<p>Once your query fits your need, click on <code>Visualize</code>. on the left menu, you can modify visualization type and few settings.</p>
<p>Example:</p>
<p><img src="img/metabase7.png" alt="Metabase - visualization example"></p>
<p><strong>Save</strong> your question when you’re satisfied ! Metabase will automatically suggest to add this question to a dashboard.</p>
<h3 id="exercise-3-build-your-first-dashboard">Exercise 3: build your first dashboard</h3>
<p>Our sales team discovered your BI platform project. They would love a first dashboard with 4 informations. we don’t judge their relevancy here 😉 :</p>
<ul>
<li>
<p>Total of customers we have.</p>
</li>
<li>
<p>Table with top 5 customers information.</p>
</li>
<li>
<p>Bar chart with orders repartition per customers.</p>
</li>
<li>
<p>Cascade chart with revenues and orders per country.</p>
</li>
<li>
<p>all of that with a dashboard filter, per country</p>
</li>
</ul>
<p>At the end it should look a bit like this:</p>
<p><img src="img/metabase8.png" alt="Metabase - visualization example"></p>
<blockquote>
<p>💡 If you have some issues with this exercise, you’ll find queries details in this repository, as always!</p>
</blockquote>
<h1 id="done-you-just-built-a-first-bi-platform">Done! You just built a first BI platform</h1>
<p>High five! Thank you for following this workshop.</p>
<p>Initial goal was to discover awesome and open source data tools, how they work, and with a common use-case.</p>
<p>I do hope that this mission is completed!</p>
<p>Do hesitate to improve this repository directly (pull request), open an issue, or share your thoughts directly.</p>
<p>Feel free to contribute and give me your feedbacks via <a href="http://twitter.com/bastienovh/">http://twitter.com/bastienovh/</a> .</p>
<h2 id="additional-resources">Additional resources</h2>
<ul>
<li>
<p>Curated list of DBT resources: <a href="https://github.com/Hiflylabs/awesome-dbt">https://github.com/Hiflylabs/awesome-dbt</a></p>
</li>
<li>
<p>Official DBT workshop: <a href="https://github.com/dbt-labs/jaffle_shop">https://github.com/dbt-labs/jaffle_shop</a></p>
</li>
<li>
<p>Official Metabase learn lessons: <a href="https://www.metabase.com/learn/">https://www.metabase.com/learn/</a></p>
</li>
</ul>
</div>
</body>

</html>
